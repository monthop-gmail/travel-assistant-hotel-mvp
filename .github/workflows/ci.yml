name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check PR has linked issue
        run: |
          if [ "${{ github.event_name }}" == "pull_request" ]; then
            PR_NUMBER=$(echo $GITHUB_REF | sed "s|refs/pull/\([0-9]*\)/merge|\1|")
            LINKED_ISSUE=$(gh api repos/${{ github.repository }}/pulls/$PR_NUMBER --jq ".body" | grep -oE "#[0-9]+" | head -1)
            if [ -z "$LINKED_ISSUE" ]; then
              echo "❌ PR must link to an issue (e.g., closes #123)"
              exit 1
            fi
            echo "✅ Linked issue found: $LINKED_ISSUE"
          fi
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Hello world
        run: echo "CI passed!"
